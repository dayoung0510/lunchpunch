<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Lunch Punch</title>


  <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link href="css/site.css" rel="stylesheet">


  <link href="https://fonts.googleapis.com/css?family=Raleway:200,400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <!-- 룰렛 -->
  <script type="text/javascript" src="js/Winwheel.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>




</head>

<body id="page-top">


  <nav class="navbar custom-nav navbar-expand-lg justify-content-center">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link custom-link" href="#play">PLAY</a>
      </li>
      <li class="nav-item">
        <a class="nav-link custom-link" href="#edit">EDIT</a>
      </li>
      <li class="nav-item">
        <a class="nav-link custom-link" href="#history">HISTORY</a>
      </li>
    </ul>
  </nav>


  <section id="play">
    <div class="container">

      <!-- 룰렛 -->
      <div class="row" style="height: 40%;">
        <div class="col-lg-12" style="height: 100%;">
          <div class="game-bg">

            <div style="height: 10%; display: flex; justify-content: center; align-items: center;">
              <button class="custom-btn" id="spin_button" onClick="startSpin();">START</button>
            </div>


            <div style="height: 90%; position: relative;">

                <!-- 룰렛 받침대 -->
                <img src="wheel_back.png" style="height: calc(100% - 10px); position: absolute; bottom: 10px; left: 50%; transform:translateX(-50%)">

                <!-- 룰렛 원판 -->
                <canvas id="canvas" width="280" height="280"
                  style="position: absolute; top: 9px; left: 50%; transform:translateX(-50%)"></canvas>

             </div>


                <!-- 모달 -->
                <div id="resultModal" class="my-modal hide">
                    <div class="modal-text">
                      <div class="howAbout"></div>
                      <div class="modal-btn">
                        <button class="custom-btn" onclick="sayYes();">OK</button>
                        <button class="custom-btn" onclick="sayNo();">RESTART</button>
                      </div>
                    </div>



                </div>




          </div>
        </div>
      </div>

      <!-- 카테고리 -->
      <div class="row padding-top-05 justify-content-center" style="height: 40%;">
        <div class="col-lg-12 flex-center" style="height:10%;">
          <div class="category-title">NEW</div>
          <div class="category-title">DAILY</div>
          <div class="category-title">SPECIAL</div>
        </div>

        <div class="col-lg-12 flex-center" style="height: 90%;">
          <div class="category">
            <ul class="category-ul" id="ul-new"></ul>
          </div>
          <div class="category">
            <ul class="category-ul" id="ul-daily"></ul>
          </div>
          <div class="category">
            <ul class="category-ul" id="ul-special"></ul>
          </div>
        </div>
      </div>

      <!-- 담은항목 -->
      <div class="row" style="height: 19%; padding: 0 1%;">
        <div class="col-lg-12 basket">
          <div style="height: 15%;">담은항목</div>
          <div class="basket-div">
            <ul class="basket-ul"></ul>
          </div>
        </div>
      </div>
    </div>
  </section>





  <section id="edit">
    <div class="container">

      <!-- 메뉴추가 -->
      <div class="row" style="height: 20%;">
        <div class="col-lg-12 add-menu">
          <div class="input-group-prepend">

            <!-- 드롭다운 -->
            <select id="drdown-category" class="btn btn-outline-lightgray dropdown-toggle">
              <option value="new">NEW</option>
              <option value="daily">DAILY</option>
              <option value="special">SPECIAL</option>
            </select>
          
            <!-- 입력창 -->
            <input id="menu-input" type="text" class="form-control">

            <!-- 확인버튼 -->
            <div class="input-group-append">
              <button id="add-menu-btn" class="btn btn-lightgray btn-outline-secondary" type="button">
                <i class="fas fa-check"></i></button>
            </div>
          </div>


        </div>
      </div>

      <!-- 카테고리 -->
      <div class="row" style="height: 80%;">
        <div class="col-lg-12 show-menu">
          <div class="flex-center">
            <div class="category-title">NEW</div>
            <div class="category-title">DAILY</div>
            <div class="category-title">SPECIAL</div>
          </div>
        </div>


        <div class="col-lg-12 flex-center" style="height: 90%;">
          <div class="category">
            <ul class="category-ul" id="category-ul-new"></ul>
          </div>
          <div class="category">
            <ul class="category-ul" id="category-ul-daily"></ul>
          </div>
          <div class="category">
            <ul class="category-ul" id="category-ul-special"></ul>
          </div>
        </div>


      </div>
    </div>
  </section>






  <section id="history">
    <div class="container">
      <div class="row" style="height: 100%;">
        <div class="col-lg-12" style="height: 100%;">







          <div class="flex-end history-title" style="height: 15%;">HISTORY</div>
          <div class="history" style="height: 75%;">

            <ul class="history-ul">
              <li>
                <span class="date">1월30일 목요일</span>
                <span class="history-menu">어쩌구저쩌구</span>
              </li>
              <li>
                <span class="date">1월30일 수요일</span>
                <span class="history-menu">어쩌</span>
              </li>
              <li>
                <span class="date">1월3일 화요일</span>
                <span class="history-menu">어쩌구</span>
              </li>
            </ul>

          </div>






        </div>
      </div>
    </div>
  </section>










<script>

  //메뉴들 json에 담아 변수로 선언
  var menus = [
    {category : "new", name : "맘스터치"},
    {category : "special", name : "수제버거"},
    {category : "daily", name : "버거킹"},
    {category : "new", name : "김치찜"},
    {category : "new", name : "된장찌개"},
    {category : "special", name : "칼국수"},
    {category : "daily", name : "미스터피자"},
    {category : "daily", name : "샐러드"},
    {category : "daily", name : "치킨"},
    {category : "daily", name : "카모메"},
    {category : "daily", name : "김가네"}
  ];


  var menusForGame = [];



function showList(){

    //위 변수에 있는 메뉴들 li형태로 보여주기
    for(var i=0; i<menus.length; i++){

    if(menus[i].category === "new") {
      //1단 카테고리에 보여주기
      $("#ul-new").append("<li> <input type='checkbox' class='chk-menu' id= chk" + i + "> <span>" + menus[i].name + "</span> </li>");
  

      //3단 카테고리에 보여주기
      $("#category-ul-new").append("<li>" + "<span>" + menus[i].name + "</span>" + "<span>" +"<i class='fas fa-times del-icon'>");
    }

    else if(menus[i].category === "special") {
      $("#ul-special").append("<li> <input type='checkbox' class='chk-menu' id= chk" + i + "> <span>" + menus[i].name + "</span> </li>");
      $("#category-ul-special").append("<li>" + "<span>" + menus[i].name + "</span>" + "<span>" +"<i class='fas fa-times del-icon'>");
    }

    else{
      $("#ul-daily").append("<li> <input type='checkbox' class='chk-menu' id= chk" + i + "> <span>" + menus[i].name + "</span> </li>");
      $("#category-ul-daily").append("<li>" + "<span>" + menus[i].name + "</span>" + "<span>" +"<i class='fas fa-times del-icon'>");
    }

  }

}

  showList();
  checkChange();






function checkChange(){
  //전체 체크박스 변화 감지
  $('.chk-menu').change(function() {

  //어레이 초기화
  menusForGame = new Array();

  //몇 번째 박스가 체크됐는지 확인
  for(var k=0; k<menus.length; k++){ 
    
    if($("#chk"+k).is(":checked")) { 

    //체크된 박스를 menusForGame 어레이에 넣기
    menusForGame.push(" " + menus[k].name + " "); 

    //게임 룰렛에 항목 들어가게 하기
    rouletteSetting();

    }
}

  // 담은항목 li 초기화
  $(" .basket-ul li").remove(); 
  
  //어레이에 있는 것들을 li에 담아 보여주기 
  $(".basket-ul").append("<li>"+ menusForGame +"</li>");

  })

  
}





  $('#add-menu-btn').click(function() {

    var drdownCat = $('#drdown-category option:selected').val();
    var inputName = $('#menu-input').val();

    var addJsonMenu = new Object();

    //input에 입력한 걸 제이슨으로 만들기
    addJsonMenu.category = drdownCat;
    addJsonMenu.name = inputName;


    //위의 제이슨을 어레이에 새로 넣기
    menus.push(addJsonMenu);

    //1단, 3단 보이는 부분 지워주기
    $('.category-ul li').remove();

    //1단, 3단 새로 보여주기
    showList();

    //게임 바구니 리셋
    $(" .basket-ul li").remove(); 

    checkChange();

  })

</script>






<script>

  $(document).ready(function(){
  rouletteSetting();
  let theWheel;

  })




  function rouletteSetting(){

  theWheel = new Winwheel({

  'numSegments' : menusForGame.length,
  'outerRadius' : 112,
  'textFontSize' : 14,
  'segments' : addTowheel(),
  'animation' :
  {
  'type' : 'spinToStop',
  'duration' : 1, // Duration in seconds.
  'spins' : 8, // Number of complete spins.
  'callbackFinished' : alertPrize
  }
  });

  }



  
//룰렛 안 컬러 설정
var colorArray = [];


    for(var i=0; i<30; i++){

      // colorArray.push('#' + Math.round(Math.random()*0xffffff).toString(16));

      //i나누기3의 나머지가 0일 때
      if(i%5 === 0){
        colorArray.push('#a4dcf5');
      }

      //i나누기3의 나머지가 1일 때
      else if(i%5 === 1){
        colorArray.push('#2d2d2d');
      }

      else if(i%5 === 2){
        colorArray.push('#9b72ca');  
      } 

      else if(i%5 === 3){
        colorArray.push('#7dba9e'); 
      }
      
      else if(i%5 === 4){
        colorArray.push('#' + Math.round(Math.random()*0xffffff).toString(16));
      }
    }






  function addTowheel(){

    ar = new Array();

    for (var i=0; i<menusForGame.length; i++){
      json = new Object();
      // json.fillStyle = '#' + Math.round(Math.random()*0xffffff).toString(16);
      json.fillStyle = colorArray[i];
      json.text = menusForGame[i];

      ar.push(json);

    }

    return ar

}



  // Vars used by the code in this page to do power controls.
  let wheelPower = 0;
  let wheelSpinning = false;


 
  function startSpin()
  {
      if (wheelSpinning == false) {

          theWheel.startAnimation();

          //결과 나올 때까지 시작버튼 눌러도 더 안돌아가게
          wheelSpinning = true;
      }
  }

  function resetWheel()
  {
      theWheel.stopAnimation(false);  // Stop the animation, false as param so does not call callback function.
      theWheel.rotationAngle = 0;     // Re-set the wheel angle to 0 degrees.
      theWheel.draw();                // Call draw to render changes to the wheel.

      wheelSpinning = false;          // Reset to false to power buttons and spin can be clicked again.
  }


  function alertPrize(indicatedSegment)
  {
    var decoText = indicatedSegment.text;

    $('.howAbout').append("오늘 점심은 '" +decoText+ "' 어떠세요?");
    showModal();
    wheelSpinning = false;
  }


  function sayYes(){
    hideModal();
    // wheelSpinning = true;
    $('#spin_button').attr('disabled', true);
    $('#spin_button').empty();
    $('#spin_button').text('오늘 게임 끝');
    $('#spin_button').css('background-color', '#454545');
    $('#spin_button').css('color', '#fff');
    $('#spin_button').css('border', 'none');
    console.log('저장로직 실행');
  }

  function sayNo(){
    $('.howAbout').empty();
    hideModal();
    resetWheel();
  }

  
  function showModal(){
    $('#resultModal').addClass('show');
    $('#resultModal').removeClass('hide');
  }

  function hideModal(){
    $('#resultModal').addClass('hide');
    $('#resultModal').removeClass('show');
  }



</script>








  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
  </script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
  </script>





</body>

</html>